name: SSH_deploy_k8s

on:
  workflow_dispatch: # –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –≤—Ä—É—á–Ω—É—é –∏–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ GitHub Actions
# on:
#   push:
#     branches:
#       - main # –°—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ –∫–æ–º–º–∏—Ç–µ –≤ –≤–µ—Ç–∫—É main

env:
  SOURCE     : "./" # –æ—Ç–∫—É–¥–∞  
  TARGET     : "~/docker_k8s" # –∫—É–¥–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

jobs:
  deploy_to_ssh:
    runs-on: ubuntu-latest # –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –û–° –Ω–∞ –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç
    
    steps:
      - name: -------Start-CD-----------
        run: echo "Start CD message" # –í—ã–≤–æ–¥–∏—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥–∏

      - name: GitHub clone code
        uses: actions/checkout@v3 # –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –∑–∞–ø—É—â–µ–Ω –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç

      - name: Deploy to Server
        uses: easingthemes/ssh-deploy@main # –ó–∞–ø—É—Å–∫–∞–µ—Ç —ç–∫—à–µ–Ω –¥–ª—è –¥–µ–ø–ª–æ—è –∫–æ–¥–∞ –ø–æ SSH
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_KEY }} # –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH-–∫–ª—é—á –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
          ARGS           : "-rlgoDzvc -i --delete" # –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è rsync, –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤
          SOURCE         : ${{ env.SOURCE }} # –æ—Ç–∫—É–¥–∞  
          REMOTE_HOST    : ${{ secrets.REMOTE_HOST }} # IP-–∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω–Ω–æ–µ –∏–º—è —Å–µ—Ä–≤–µ—Ä–∞
          REMOTE_USER    : ${{ secrets.REMOTE_USER }} # –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É
          TARGET         : ${{ env.TARGET }} # –∫—É–¥–∞ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ
          SCRIPT_BEFORE: |
            ls -la # –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –≤ –ª–æ–≥–∏ –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º
          SCRIPT_AFTER: |
            cd ${{ env.TARGET }} # –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É —Å –∫–æ–¥–æ–º
            ls -la # –í—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –≤ –ª–æ–≥–∏ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
      - name: -------Finish-CD-----------
        run: |
          echo "üçè This job's status is ${{ job.status }}." # –í—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –¥–µ–ø–ª–æ–π–º–µ–Ω—Ç–∞ –≤ –ª–æ–≥–∏ —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ç–∞—Ç—É—Å–∞ —Ä–∞–±–æ—Ç—ã –¥–∂–æ–±—ã (success/failure)
